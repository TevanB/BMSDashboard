{"remainingRequest":"/Users/tevb/Documents/BMS/BMSDashboard/node_modules/@vue/cli-service/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/tevb/Documents/BMS/BMSDashboard/resources/js/components/OrderChat.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/tevb/Documents/BMS/BMSDashboard/resources/js/components/OrderChat.vue","mtime":1613347835579},{"path":"/Users/tevb/Documents/BMS/BMSDashboard/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/tevb/Documents/BMS/BMSDashboard/node_modules/@vue/cli-service/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCgppbXBvcnQgRm9ybSBmcm9tICd2Zm9ybSc7CmltcG9ydCBIYXNFcnJvciBmcm9tICd2Zm9ybSc7CiAgICBleHBvcnQgZGVmYXVsdCB7CiAgICAgICAgcHJvcHM6IFsnb3JkZXJfaWQnXSwKCiAgICAgICAgZGF0YSgpewogICAgICAgICAgcmV0dXJuewogICAgICAgICAgICB1c2VyOiB7fSwKICAgICAgICAgICAgbWVzc2FnZXM6W10sCiAgICAgICAgICAgIHJlc3VsdDogbmV3IEZvcm0oewogICAgICAgICAgICAgb3JkZXJfaWQ6ICcnLAogICAgICAgICAgICAgbWVzc2FnZTogJycKICAgICAgICAgICAgfSksCiAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICBtb3VudGVkKCkgewogICAgICAgICAgICAvL2NvbnNvbGUubG9nKCdDb21wb25lbnQgbW91bnRlZC4nKQoKICAgICAgICAgICAgLy9jb25zb2xlLmxvZyh3aW5kb3cuRWNoby5wcml2YXRlKCdjaGF0JykpOwogICAgICAgICAgICB3aW5kb3cuRWNoby5wcml2YXRlKCdjaGF0JykKICAgICAgICAgICAgICAubGlzdGVuKCdtZXNzYWdlLXNlbnQnLCAoZSkgPT4gewogICAgICAgICAgICAgIC8vY29uc29sZS5sb2coIk1FU1NBR0UgU0VOVCBSRVFVRVNUIEhFQVJEIik7CgogICAgICAgICAgICAgICAgdGhpcy5mZXRjaE1lc3NhZ2VzKCk7CgogICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgLmxpc3RlbignVXBkYXRlUmVxdWVzdCcsIChlKT0+ewogICAgICAgICAgICAgICAgLy9jb25zb2xlLmxvZyhlKTsKICAgICAgICAgICAgICAgIC8vY29uc29sZS5sb2coIlVQREFURSBSRVFVRVNUIEhFQVJEIik7CiAgICAgICAgICAgICAgICB0aGlzLmZldGNoTWVzc2FnZXMoKTsKCiAgICAgICAgICAgICAgfSk7CgoKCiAgICAgICAgICAgIC8vdGhpcy5zY3JvbGxUb0VuZCgpOwogICAgICAgICAgICAvL2NvbnNvbGUubG9nKHRoaXMuJGVsLnF1ZXJ5U2VsZWN0b3IoIiNzY3JvbGxlciIpKTsKCiAgICAgICAgICAgIHRoaXMuZmV0Y2hNZXNzYWdlcygpOwoKCiAgICAgICAgfSwKICAgICAgICB1cGRhdGVkKCl7CiAgICAgICAgICAvL2NvbnNvbGUubG9nKCdvcmRlciBjaGF0IHVwZGF0ZWQnKTsKCiAgICAgICAgICB0aGlzLiRlbWl0KCd1cGRhdGVyZXF1ZXN0Jyk7CgogICAgICAgIH0sCiAgICAgICAgbWV0aG9kczp7CiAgICAgICAgICBzY3JvbGxUb0VuZCgpIHsKICAgICAgICAgICAgc2V0VGltZW91dCgoKT0+ewogICAgICAgICAgICB2YXIgY29udGFpbmVyID0gdGhpcy4kZWwucXVlcnlTZWxlY3RvcigiI3Njcm9sbGVyIik7CiAgICAgICAgICAgIGNvbnRhaW5lci5zY3JvbGxUb3AgPSBjb250YWluZXIuc2Nyb2xsSGVpZ2h0OwogICAgICAgICAgICB9LCAxMDAwKTsKCiAgICAgICAgICB9LAogICAgICAgICAgZ2V0VXNlcigpewogICAgICAgICAgICBheGlvcy5nZXQoImh0dHBzOi8vYm1zLWJhY2tlbmQtc2V0dXAtcGF5b3UtcnM4cWt5Lmhlcm9rdWFwcC5jb20vYXBpL21lIikudGhlbigoZGF0YSk9PnsKCiAgICAgICAgICAgICAgdGhpcy51c2VyID0gZGF0YS5kYXRhLm5hbWU7CiAgICAgICAgICAgICAgLy8vL2NvbnNvbGUubG9nKHRoaXMudXNlcik7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSwKICAgICAgICAgIGFkZE1lc3NhZ2UobWVzc2FnZSkgewoKICAgICAgICAgICAgICAvL2NvbnNvbGUubG9nKHRoaXMubWVzc2FnZXMpOwogICAgICAgICAgICAgIC8vIG1lc3NhZ2UgaXMgdGhlIHN0cmluZyBub3QgdGhlIG9iamVjdAogICAgICAgICAgICAgIHRoaXMubWVzc2FnZXMucHVzaChtZXNzYWdlKTsKCgogICAgICAgICAgICAgIHRoaXMucmVzdWx0Lm9yZGVyX2lkID0gdGhpcy5vcmRlcl9pZC5vcmRlcl9pZDsKICAgICAgICAgICAgICB0aGlzLnJlc3VsdC5tZXNzYWdlID0gbWVzc2FnZTsKICAgICAgICAgICAgICBheGlvcy5wb3N0KCdodHRwczovL2Jtcy1iYWNrZW5kLXNldHVwLXBheW91LXJzOHFreS5oZXJva3VhcHAuY29tL21lc3NhZ2VzJywgdGhpcy5yZXN1bHQpLnRoZW4ocmVzcG9uc2UgPT4gewogICAgICAgICAgICAgICAgLy9jb25zb2xlLmxvZyhyZXNwb25zZS5kYXRhKTsKICAgICAgICAgICAgICAgIHRoaXMuZmV0Y2hNZXNzYWdlcygpOwoKICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgLy9jb25zaWRlciBpbmRpdmlkdWFsbHkgYWRkaW5nIG5ld2VzdCBtZXNzYWdlIGRpcmVjdGx5CiAgICAgICAgICAgICAgLy9wcm9ibGVtIGlzIGxhc3QgbWVzc2FnZSBub3QgcmVnaXN0ZXJpbmcgaW4gZ2V0IHJlcSBzbyBsZWZ0IG91dCBpbiB1cGRhdGUKCiAgICAgICAgICB9LAogICAgICAgICAgZmV0Y2hNZXNzYWdlcygpIHsKICAgICAgICAgICAgICBsZXQgdGhhdCA9IHRoaXM7CiAgICAgICAgICAgICAgYXhpb3MuZ2V0KCdodHRwczovL2Jtcy1iYWNrZW5kLXNldHVwLXBheW91LXJzOHFreS5oZXJva3VhcHAuY29tL21lc3NhZ2VzLycrIHRoYXQub3JkZXJfaWQub3JkZXJfaWQpLnRoZW4ocmVzcG9uc2UgPT4gewogICAgICAgICAgICAgICAgICAvL2NvbnNvbGUubG9nKHJlc3BvbnNlKTsKICAgICAgICAgICAgICAgICAgdGhpcy5tZXNzYWdlcyA9IHJlc3BvbnNlLmRhdGE7CiAgICAgICAgICAgICAgICAgIHRoaXMuc2Nyb2xsVG9FbmQoKTsKCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgLy9jb25zb2xlLmxvZygnbWVzc2FnZXMgZmV0Y2hlZCcpOwogICAgICAgICAgfSwKICAgICAgICB9LAogICAgICAgIGNyZWF0ZWQoKXsKICAgICAgICAgIHRoaXMuZ2V0VXNlcigpOwogICAgICAgICAgdGhpcy5mZXRjaE1lc3NhZ2VzKCk7CiAgICAgICAgfQogICAgfQo="},{"version":3,"sources":["OrderChat.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;AA0BA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;;;;AAIA;AACA;;AAEA;;;AAGA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"OrderChat.vue","sourceRoot":"components","sourcesContent":["<template>\n    <div class=\"container\">\n        <div class=\"row justify-content-center\">\n          <div class=\"col-md-8 col-md-offset-2\">\n              <div class=\"panel panel-default\">\n\n                  <div id=\"scroller\" class=\"panel-body mt-3 mb-3\">\n                      <chat-messages :messages=\"messages\" :order_id=\"order_id\"\n                      v-on:change=\"scrollToEnd\"\n                      ></chat-messages>\n                  </div>\n                  <div class=\"panel-footer mb-3\">\n                      <chat-form\n                          v-on:messagesent=\"addMessage\"\n                          :user=\"{ user }\"\n                          :orderid=\"{ order_id }\"\n                      ></chat-form>\n                  </div>\n              </div>\n          </div>\n        </div>\n    </div>\n</template>\n\n<script>\n\nimport Form from 'vform';\nimport HasError from 'vform';\n    export default {\n        props: ['order_id'],\n\n        data(){\n          return{\n            user: {},\n            messages:[],\n            result: new Form({\n             order_id: '',\n             message: ''\n            }),\n          }\n        },\n        mounted() {\n            //console.log('Component mounted.')\n\n            //console.log(window.Echo.private('chat'));\n            window.Echo.private('chat')\n              .listen('message-sent', (e) => {\n              //console.log(\"MESSAGE SENT REQUEST HEARD\");\n\n                this.fetchMessages();\n\n              })\n              .listen('UpdateRequest', (e)=>{\n                //console.log(e);\n                //console.log(\"UPDATE REQUEST HEARD\");\n                this.fetchMessages();\n\n              });\n\n\n\n            //this.scrollToEnd();\n            //console.log(this.$el.querySelector(\"#scroller\"));\n\n            this.fetchMessages();\n\n\n        },\n        updated(){\n          //console.log('order chat updated');\n\n          this.$emit('updaterequest');\n\n        },\n        methods:{\n          scrollToEnd() {\n            setTimeout(()=>{\n            var container = this.$el.querySelector(\"#scroller\");\n            container.scrollTop = container.scrollHeight;\n            }, 1000);\n\n          },\n          getUser(){\n            axios.get(\"https://bms-backend-setup-payou-rs8qky.herokuapp.com/api/me\").then((data)=>{\n\n              this.user = data.data.name;\n              ////console.log(this.user);\n            });\n          },\n          addMessage(message) {\n\n              //console.log(this.messages);\n              // message is the string not the object\n              this.messages.push(message);\n\n\n              this.result.order_id = this.order_id.order_id;\n              this.result.message = message;\n              axios.post('https://bms-backend-setup-payou-rs8qky.herokuapp.com/messages', this.result).then(response => {\n                //console.log(response.data);\n                this.fetchMessages();\n\n              });\n\n              //consider individually adding newest message directly\n              //problem is last message not registering in get req so left out in update\n\n          },\n          fetchMessages() {\n              let that = this;\n              axios.get('https://bms-backend-setup-payou-rs8qky.herokuapp.com/messages/'+ that.order_id.order_id).then(response => {\n                  //console.log(response);\n                  this.messages = response.data;\n                  this.scrollToEnd();\n\n              });\n              //console.log('messages fetched');\n          },\n        },\n        created(){\n          this.getUser();\n          this.fetchMessages();\n        }\n    }\n</script>\n<!-- Styles -->\n<link href=\"{{ asset('css/app.css') }}\" rel=\"stylesheet\">\n\n<style module>\n  .chat {\n    list-style: none;\n    margin: 0;\n    padding: 0;\n  }\n\n  .chat li {\n    margin-bottom: 10px;\n    padding-bottom: 5px;\n    border-bottom: 1px dotted #B3A9A9;\n  }\n\n  .chat li .chat-body p {\n    margin: 0;\n    color: #777777;\n  }\n\n  .panel-body {\n    overflow-y: scroll;\n    height: 350px;\n    display: flex;\n    flex-direction: column-reverse;\n  }\n\n  ::-webkit-scrollbar-track {\n    -webkit-box-shadow: inset 0 0 6px rgba(0,0,0,0.3);\n    background-color: #F5F5F5;\n  }\n\n  ::-webkit-scrollbar {\n    width: 12px;\n    background-color: #F5F5F5;\n  }\n\n  ::-webkit-scrollbar-thumb {\n    -webkit-box-shadow: inset 0 0 6px rgba(0,0,0,.3);\n    background-color: #555;\n  }\n</style>\n"]}]}